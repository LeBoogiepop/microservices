{% extends "base.html" %}

{% block title %}Microservices ESME{% endblock %}

{% block content %}
<style>
    body { background-color: #f5f5f5; }
    .card { border: 1px solid #000; }
    .btn-primary { background-color: #000; border-color: #000; }
    .btn-primary:hover { background-color: #333; border-color: #333; }
    .btn-success { background-color: #000; border-color: #000; }
    .btn-success:hover { background-color: #333; border-color: #333; }
    .btn-secondary { background-color: #666; border-color: #666; }
    .text-primary { color: #000 !important; }
    .text-success { color: #000 !important; }
    .text-danger { color: #000 !important; }
    .text-warning { color: #666 !important; }
    .bg-success { background-color: #e0e0e0 !important; color: #000 !important; }
    .bg-danger { background-color: #000 !important; color: #fff !important; }
    .bg-warning { background-color: #999 !important; color: #000 !important; }
</style>
<div class="row justify-content-center">
    <div class="col-md-6">
        <h3 class="mb-3 text-center">Cours Microservices ESME</h3>
        
        <!-- Page principale avec le produit -->
            <div class="alert alert-light border mb-3">
                <small><strong>ConnectÃ©:</strong> {{ session.get('username') }}</small>
                <a href="{{ url_for('logout') }}" class="btn btn-sm btn-outline-dark float-end">DÃ©connexion</a>
            </div>
            
            <!-- Ã‰tat du circuit breaker -->
            <div class="card mb-3">
                <div class="card-header text-center py-2" style="{% if etat_circuit == 0 %}background-color: #e0e0e0;{% elif etat_circuit == 1 %}background-color: #000; color: #fff;{% else %}background-color: #999; color: #fff;{% endif %}">
                    <strong>
                        {% if etat_circuit == 0 %}
                            CIRCUIT FERMÃ‰
                        {% elif etat_circuit == 1 %}
                            CIRCUIT OUVERT
                        {% else %}
                            CIRCUIT SEMI-OUVERT
                        {% endif %}
                    </strong>
                </div>
                <div class="card-body py-2">
                    <div class="row text-center">
                        <div class="col-4">
                            <small class="text-muted">Ã‰checs</small>
                            <div><strong>{{ nb_echecs }}/3</strong></div>
                        </div>
                        <div class="col-4">
                            <small class="text-muted">Appels</small>
                            <div><strong>{{ compteur_appels }}</strong></div>
                        </div>
                        <div class="col-4">
                            <small class="text-muted">Ã‰tat</small>
                            <div><strong>
                                {% if etat_circuit == 0 %}
                                    OK
                                {% elif etat_circuit == 1 %}
                                    ERREUR
                                {% else %}
                                    TEST
                                {% endif %}
                            </strong></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Produit unique -->
            <div class="card">
                <div class="card-body text-center p-4">
                    <h5>{{ produit.nom }}</h5>
                    <p class="h4 mt-2 mb-3"><strong>{{ produit.prix }} EUR</strong></p>
                    
                    <form method="POST" action="{{ url_for('payer') }}" class="mt-3">
                        <button type="submit" class="btn btn-dark" {% if etat_circuit == 1 %}disabled{% endif %}>
                            Payer maintenant
                        </button>
                    </form>
                    
                    {% if etat_circuit == 1 %}
                    <div class="alert alert-dark mt-3 mb-0 py-2">
                        <small><strong>CIRCUIT OUVERT</strong><br>
                        Attendez 30 secondes avant de rÃ©essayer.</small>
                    </div>
                    {% endif %}
                </div>
            </div>
            

            <!-- Gestion des utilisateurs SQLite -->
            <div class="card mt-3">
                <div class="card-header bg-dark text-white text-center py-2">
                    <strong>ðŸ‘¥ Gestion des utilisateurs</strong>
                </div>
                <div class="card-body text-center p-3">
                    <p class="mb-3"><small>Base de donnÃ©es: <strong>users.db</strong></small></p>
                    <div class="d-grid gap-2">
                        <a href="{{ url_for('ajouter_utilisateur') }}" class="btn btn-success">
                            âž• Ajouter un utilisateur
                        </a>
                        <a href="{{ url_for('liste_utilisateurs') }}" class="btn btn-outline-dark">
                            ðŸ“‹ Voir tous les utilisateurs
                        </a>
                    </div>
                </div>
            </div>
    </div>
</div>
{% endblock %}
